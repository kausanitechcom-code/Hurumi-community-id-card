<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Registration</title>

  <style>
    body {
      font-family: Arial;
      padding: 20px;
    }
    input, select, button {
      width: 100%;
      height: 50px
      padding: 10px;
      margin-bottom: 10px;
    }
    button {
      background: green;
      color: white;
      border: none;
      font-size: 16px;
      cursor: pointer;
      border-radius:2px;
      max-width:300px;
    }
    h3{
      font-family: Times new roman;
      text-allign:center;
      font-weight:bold;
      margin-left:60px;
    }
  </style>
</head>
<!-- Firebase SDK (COMPAT VERSION â€“ REQUIRED) -->
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-storage-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyC76jZGL4MtChgHOxB9PG3RkESEiRzp3E0",
    authDomain: "kausani-community-id.firebaseapp.com",
    projectId: "kausani-community-id",
    storageBucket: "kausani-community-id.appspot.com",
    messagingSenderId: "762265515508",
    appId: "1:762265515508:web:4fb65c6c7c42e7cfc8b5a1"
  };

  firebase.initializeApp(firebaseConfig);

  const db = firebase.firestore();
  const storage = firebase.storage();
</script>
  <script>
async function goToID() {
  const name = document.getElementById("name").value.trim();
  const phone = document.getElementById("phone").value.trim();
  const address = document.getElementById("address").value;
  const photo = document.getElementById("photo").files[0];

  if (!name || !phone || !address || !photo) {
    alert("Please fill all fields and upload photo");
    return;
  }

  try {
    const idNumber = "KC-" + Math.floor(100000 + Math.random() * 900000);

    const photoRef = storage.ref("photos/" + idNumber);
    await photoRef.put(photo);
    const photoURL = await photoRef.getDownloadURL();

    await db.collection("community_ids").add({
      name,
      phone,
      address,
      idNumber,
      photoURL,
      createdAt: firebase.firestore.FieldValue.serverTimestamp()
    });

    window.location.href =
      `id-card.html?name=${encodeURIComponent(name)}&phone=${encodeURIComponent(phone)}&address=${encodeURIComponent(address)}&id=${idNumber}&photo=${encodeURIComponent(photoURL)}`;

  } catch (err) {
    alert("Upload failed. Check internet.");
    console.error(err);
  }
}
      </script>
<body>

<h3>Fill in the below information</h3>

<input id="name" placeholder="Enter your Name">
<input id="phone" placeholder="Enter your phone number">
<input id="dob" type="date">

<select id="address">
  <option value="">Choose your address</option>
  <option>Kausani Hurumi</option>
  <option>Kwanar Kausani</option>
  <option>Kiri-Kasamma</option>
  <option>Manga</option>
  <option>Masama</option>
  <option>Rege</option>
  <option>Munchika</option>
  <option>Kwarin Manga</option>
  <option>Gaccin Lungu</option>
  <option>Gaccin Titi</option>
  <option>Turari</option>
  <option>Gurbo</option>
  <option>Gidan Bello</option>
  </select>

<label>Upload your photo:</label>
<input id="photo" type="file" accept="image/*">

<button onclick="goToID()">Generate ID Card</button>

<script>
function goToID() {
  const name = document.getElementById("name").value;
  const phone = document.getElementById("phone").value;
  const address = document.getElementById("address").value;
  const photoInput = document.getElementById("photo");

  if (!photoInput.files[0]) {
    alert("Please upload a photo!");
    return;
  }

  const reader = new FileReader();
  reader.onload = function () {
    const data = {
      name,
      phone,
      address,
      photo: reader.result
    };
    const encoded = encodeURIComponent(JSON.stringify(data));
    window.location.href = "id-card.html?data=" + encoded;
  };
  reader.readAsDataURL(photoInput.files[0]);
}
</script>

</body>
</html>
